name: Manter M√∫ltiplos Sites Ativos

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

env:
  MAX_RETRIES: 3
  RETRY_DELAY: 5
  TIMEOUT_SECONDS: 30
  ACCEPTED_CODES: "200 302 307 403"

jobs:
  verificar-sites:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        site: [
          "https://flixtvon-aiolist.hf.space",
          "https://flixtvon-aiostremio.hf.space/stremio/configure", 
          "https://streamflixapi.brunoflix9.workers.dev",
          "https://flixtvon-chatgpt-v1.hf.space"
        ]
    steps:
      - name: Verificar ${{ matrix.site }}
        run: |
          echo "üîç Verificando: ${{ matrix.site }}"
          
          for ((i=1; i<=$MAX_RETRIES; i++)); do
            echo "Tentativa $i de $MAX_RETRIES..."
            
            inicio=$(date +%s%3N)
            http_code=$(curl -s -o /dev/null \
              -w "%{http_code}" \
              --max-time $TIMEOUT_SECONDS \
              -H "User-Agent: GitHub-Actions-Ping/1.0" \
              "${{ matrix.site }}")
            fim=$(date +%s%3N)
            tempo_resposta=$((fim - inicio))
            
            if [[ " $ACCEPTED_CODES " =~ " $http_code " ]]; then
              echo "‚úÖ Sucesso! HTTP: $http_code | Tempo de Resposta: ${tempo_resposta}ms"
              exit 0
            else
              echo "‚ùå Falhou com HTTP: $http_code | Tempo de Resposta: ${tempo_resposta}ms"
              if [ $i -lt $MAX_RETRIES ]; then
                echo "Aguardando $RETRY_DELAY segundos antes de tentar novamente..."
                sleep $RETRY_DELAY
              fi
            fi
          done
          
          echo "‚ö†Ô∏è Todas as $MAX_RETRIES tentativas falharam para ${{ matrix.site }}"
          exit 1
